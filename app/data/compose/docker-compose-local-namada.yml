version: "3.8"

services:
  namada-1:
    restart: unless-stopped
    hostname: namada-1
    image: cerc/namada:local
    entrypoint: ["sh", "/docker-entrypoint-scripts.d/start-node.sh"]
    volumes:
      - ../config/local-namada/start-node.sh:/docker-entrypoint-scripts.d/start-node.sh
      - ../config/local-namada/key-gen.exp:/scripts/key-gen.exp
      - namada-1_data:/root/.local/share/namada
      - namada-shared:/root/.namada-shared
      - ../config/local-namada/genesis:/genesis:ro
      - ../config/local-namada/make_balances.py:/scripts/make_balances.py
    environment:
      # - CHAIN_ID=$CHAIN_ID
      - P2P_PORT=${P2P_PORT}
      - EXTIP=${EXTIP}
    ports:
      - "${P2P_PORT}:26656" # p2p
      - "26657" # http rpc
      - "${SERVE_PORT}:8123" # configs server

  namada-2:
    restart: unless-stopped
    hostname: namada-2
    image: cerc/namada:local
    entrypoint: ["sh", "/docker-entrypoint-scripts.d/start-node.sh"]
    volumes:
      - ../config/local-namada/start-node.sh:/docker-entrypoint-scripts.d/start-node.sh
      - ../config/local-namada/key-gen.exp:/scripts/key-gen.exp
      - namada-2_data:/root/.local/share/namada
      - namada-shared:/root/.namada-shared
    # environment:
    #   - CHAIN_ID=$CHAIN_ID
    ports:
      - "26656" # p2p
      - "26657" # http rpc
    
  namada-3:
    restart: unless-stopped
    hostname: namada-3
    image: cerc/namada:local
    entrypoint: ["sh", "/docker-entrypoint-scripts.d/start-node.sh"]
    volumes:
      - ../config/local-namada/start-node.sh:/docker-entrypoint-scripts.d/start-node.sh
      - ../config/local-namada/key-gen.exp:/scripts/key-gen.exp
      - namada-3_data:/root/.local/share/namada
      - namada-shared:/root/.namada-shared
    # environment:
    #   - CHAIN_ID=$CHAIN_ID
    ports:
      - "26656" # p2p
      - "${RPC_PORT}:26657" # http rpc
      - "${PROM_PORT}:26660"

volumes:
  namada-1_data:
  namada-2_data:
  namada-3_data:
  namada-shared: